<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Preview | FramerKit</title>
  <link rel="stylesheet" href="/preview/viewer.css" />
  
  <!-- ‚úÖ –§–∞–≤–∏–∫–æ–Ω (–ø–æ–¥—Å—Ç–∞–≤—å —Å–≤–æ–π –ø—É—Ç—å) -->
  <link rel="icon" type="image/png" href="/Logo.png" />
  <link rel="apple-touch-icon" href="/Logo.png" />
  
  <!-- ‚úÖ –ú–µ—Ç–∞-—Ç–µ–≥–∏ –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ —à–µ—Ä–∏–Ω–≥–∞ -->
  <meta name="description" content="FramerKit Component Preview" />
  <meta property="og:title" content="FramerKit Preview" />
  <meta property="og:image" content="/Logo.png" />
  
  <!-- –°—Ç–∏–ª–∏ -->
  <link rel="stylesheet" href="/preview/viewer.css" />
</head>
<body>
  <!-- üî• TOOLBAR -->
  <div class="preview-toolbar">
 <div class="logo">
  <img 
    src="/Logo.png" 
    alt="FramerKit" 
    class="logo-image"
    width="32"
    height="32"
  />
  <span>FramerKit</span>
</div>

    <!-- Device Toggle -->
    <div class="device-toggle">
      <button class="device-btn" data-device="desktop" title="Desktop (1200px)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="2" y="3" width="20" height="14" rx="2" />
          <line x1="8" y1="21" x2="16" y2="21" />
          <line x1="12" y1="17" x2="12" y2="21" />
        </svg>
      </button>
      <button class="device-btn" data-device="tablet" title="Tablet (768px)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="4" y="2" width="16" height="20" rx="2" />
          <line x1="12" y1="18" x2="12" y2="18.01" />
        </svg>
      </button>
      <button class="device-btn" data-device="mobile" title="Mobile (375px)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="5" y="2" width="14" height="20" rx="2" />
          <line x1="12" y1="18" x2="12" y2="18.01" />
        </svg>
      </button>
    </div>

    <!-- Width & Height Inputs -->
    <div class="size-inputs">
      <div class="size-input-group">
        <input 
          type="number" 
          id="widthInput" 
          value="1200" 
          min="320" 
          max="1920"
          class="size-input"
        />
        <span class="size-label">W</span>
      </div>
      <div class="size-input-group">
        <input 
          type="number" 
          id="heightInput" 
          value="617" 
          min="200" 
          max="2000"
          class="size-input"
        />
        <span class="size-label">H</span>
      </div>
    </div>

    <!-- Fullscreen Button -->
    <button class="fullscreen-btn" title="Fullscreen (F)">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3" />
      </svg>
    </button>
  </div>

  <!-- üì± PREVIEW CONTAINER -->
  <div class="preview-container" id="previewContainer">
    <div class="resizable-wrapper desktop" id="resizableWrapper">
      <!-- Loading overlay -->
      <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
      </div>

      <!-- Resize handles -->
      <div class="resize-handle left" id="resizeLeft"></div>
      <div class="resize-handle right" id="resizeRight"></div>

      <!-- Iframe —Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º -->
      <iframe 
        src="" 
        class="preview-frame"
        id="previewFrame"
        loading="lazy"
      ></iframe>
    </div>

    <!-- Width indicator -->
    <div class="width-indicator" id="widthIndicator">1200px</div>
  </div>

  <!-- JavaScript -->
  <script>
// ============================================
// INIT ‚Äî –Ω–∞–¥—ë–∂–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –ø—É—Ç–∏ —Å /p/
// ============================================
console.log('üîç viewer.html STARTED');
console.log('üîç Full URL:', window.location.href);
console.log('üîç Pathname:', window.location.pathname);

const path = window.location.pathname; // /p/navbar/navbar-01-wireframe

// –ü—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ –ø—É—Ç—å –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç /p/, –≤–æ–∑–º–æ–∂–Ω–æ rewrite –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª
if (!path.startsWith('/p/') && !path.includes('viewer.html')) {
  console.warn('‚ö†Ô∏è viewer.html loaded but path does not start with /p/');
  console.warn('‚ö†Ô∏è Possible direct file access - rewrite may not be working');
}

const parts = path.split('/').filter(p => p); // ['p', 'navbar', 'navbar-01-wireframe']
console.log('üîç Path parts:', parts);

// –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–º—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (–ø–æ—Å–ª–µ–¥–Ω—è—è —á–∞—Å—Ç—å)
let componentName = parts[parts.length - 1] || '';
console.log('üîç Raw componentName:', componentName);

// üî• –ß–∏—Å—Ç–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ç –ª–∏—à–Ω–∏—Ö —Å–ª–æ–≤
componentName = componentName
  .replace(/-preview$/i, '')
  .replace(/preview$/i, '')
  .replace(/-wireframe$/i, '-wireframe')
  .replace(/-+/g, '-')
  .replace(/^-|-$/g, '');

if (!componentName) componentName = 'Component';
console.log('üîç Clean componentName:', componentName);

// –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º: navbar-01-wireframe ‚Üí Navbar 01 Wireframe
const formattedTitle = componentName
  .split('-')
  .map(word => {
    if (!word) return '';
    const withSpace = word.replace(/(\d)/g, ' $1').trim();
    return withSpace.charAt(0).toUpperCase() + withSpace.slice(1);
  })
  .filter(w => w)
  .join(' ');

console.log('üîç Formatted title:', formattedTitle);

// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
document.title = `${formattedTitle} | FramerKit`;
const titleEl = document.querySelector('title');
if (titleEl) titleEl.textContent = `${formattedTitle} | FramerKit`;

// –°–æ–±–∏—Ä–∞–µ–º –ø—É—Ç—å –∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É (—Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ /preview/)
const componentParts = parts.slice(1); // ['navbar', 'navbar-01-wireframe']
const componentPath = '/preview/' + componentParts.join('/');
console.log('‚úÖ Final componentPath for iframe:', componentPath);

// –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ iframe
const previewFrame = document.getElementById('previewFrame');

if (previewFrame && componentPath) {
  console.log('üîó Setting iframe src...');
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
  previewFrame.addEventListener('load', function onLoad() {
    console.log('‚úÖ iframe loaded successfully');
    console.log('‚úÖ iframe final src:', previewFrame.src);
    
    // –°–∫—Ä—ã–≤–∞–µ–º –ª–æ–∞–¥–µ—Ä
    const loader = document.getElementById('loadingOverlay');
    if (loader) {
      loader.style.opacity = '0';
      setTimeout(() => { loader.style.display = 'none'; }, 300);
    }
    
    // –£–¥–∞–ª—è–µ–º listener —á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–ª—Å—è
    previewFrame.removeEventListener('load', onLoad);
  });
  
  previewFrame.addEventListener('error', function onError() {
    console.error('‚ùå iframe failed to load');
    console.error('‚ùå Tried to load:', componentPath);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    const loader = document.getElementById('loadingOverlay');
    if (loader) {
      loader.innerHTML = '<p style="color:red;padding:20px">Failed to load component</p>';
    }
    
    previewFrame.removeEventListener('error', onError);
  });
  
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º src (–≤ –∫–æ–Ω—Ü–µ, –ø–æ—Å–ª–µ listeners)
  previewFrame.src = componentPath;
} else {
  console.error('‚ùå previewFrame not found or componentPath empty');
  console.error('‚ùå previewFrame:', document.getElementById('previewFrame'));
  console.error('‚ùå componentPath:', componentPath);
}
    const deviceBtns = document.querySelectorAll('.device-btn');
    const resizableWrapper = document.getElementById('resizableWrapper');
    const previewContainer = document.getElementById('previewContainer');
    const fullscreenBtn = document.querySelector('.fullscreen-btn');
    const resizeLeft = document.getElementById('resizeLeft');
    const resizeRight = document.getElementById('resizeRight');
    const widthIndicator = document.getElementById('widthIndicator');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const widthInput = document.getElementById('widthInput');
    const heightInput = document.getElementById('heightInput');
    
    let isFullscreen = false;
    let isResizing = false;
    let startX = 0;
    let startWidth = 1200;
    
    // ============================================
    // DEVICE SWITCH
    // ============================================
    deviceBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const device = btn.dataset.device;
    
        deviceBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    
        let width = 1200;
        if (device === 'tablet') width = 768;
        if (device === 'mobile') width = 375;
    
        setWidth(width);
      });
    });
    
    // ============================================
    // WIDTH / HEIGHT INPUT
    // ============================================
    widthInput.addEventListener('input', e => {
      let value = parseInt(e.target.value) || 1200;
      value = clamp(value, 320, 1920);
      setWidth(value);
      deviceBtns.forEach(b => b.classList.remove('active'));
    });
    
    heightInput.addEventListener('input', e => {
      let value = parseInt(e.target.value) || 600;
      value = clamp(value, 200, 2000);
      resizableWrapper.style.height = value + 'px';
      deviceBtns.forEach(b => b.classList.remove('active'));
    });
    
    // ============================================
    // SET WIDTH (—Ü–µ–Ω—Ç—Ä –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ)
    // ============================================
    function setWidth(width) {
      resizableWrapper.style.width = width + 'px';
      widthInput.value = Math.round(width);
      showWidthIndicator(width);
    }
    
    // ============================================
    // FULLSCREEN
    // ============================================
    fullscreenBtn.addEventListener('click', toggleFullscreen);
    
    document.addEventListener('keydown', e => {
      if (e.key === 'f' || e.key === 'F') toggleFullscreen();
      if (e.key === 'Escape' && isFullscreen) toggleFullscreen();
    });
    
    function toggleFullscreen() {
      isFullscreen = !isFullscreen;
      previewContainer.classList.toggle('fullscreen');
      resizableWrapper.classList.toggle('fullscreen');
    }
    
    // ============================================
    // RESIZE (–∫–∞–∫ —É Framer ‚Äî —Ü–µ–Ω—Ç—Ä —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω)
    // ============================================
    function initResize(handle, side) {

handle.addEventListener('pointerdown', e => {
  isResizing = true;
  startX = e.clientX;
  startWidth = resizableWrapper.offsetWidth;

  resizableWrapper.style.transition = 'none';

  // üî• —Ñ–∏–∫—Å –∑–∞–ª–∏–ø–∞–Ω–∏—è
  previewFrame.style.pointerEvents = 'none';

  handle.setPointerCapture(e.pointerId);

  document.addEventListener('pointermove', onResize);
  document.addEventListener('pointerup', stopResize);

  e.preventDefault();
});

function onResize(e) {
  if (!isResizing) return;

  let delta = e.clientX - startX;
  let newWidth = startWidth + (side === 'right' ? delta * 2 : -delta * 2);
  newWidth = clamp(newWidth, 320, 1920);

  setWidth(newWidth);
}

function stopResize(e) {
  isResizing = false;

  resizableWrapper.style.transition = 'width 0.25s ease';

  // üî• –≤–æ–∑–≤—Ä–∞—â–∞–µ–º iframe
  previewFrame.style.pointerEvents = 'auto';

  document.removeEventListener('pointermove', onResize);
  document.removeEventListener('pointerup', stopResize);

  try {
    handle.releasePointerCapture(e.pointerId);
  } catch {}

  widthIndicator.classList.remove('show');
}
}

initResize(resizeLeft, 'left');
initResize(resizeRight, 'right');
    
    // ============================================
    // WIDTH INDICATOR
    // ============================================
    function showWidthIndicator(width) {
      widthIndicator.textContent = Math.round(width) + 'px';
      widthIndicator.classList.add('show');
    }
    
    function clamp(value, min, max) {
      return Math.max(min, Math.min(value, max));
    }
    
    // ============================================
    // LOADING
    // ============================================
    previewFrame.addEventListener('load', () => {
      loadingOverlay.style.opacity = '0';
      setTimeout(() => {
        loadingOverlay.style.display = 'none';
      }, 300);
    });
    </script>
</body>
</html>